# 單詞本合併功能重構計劃

## 1. 現狀分析

當前應用的“合併單詞本”功能實現較為基礎。

- **觸發點**: 用戶點擊單詞本上方的“合併”圖標按鈕 (`merge-vocab-books-btn`)。
- **UI生成**: JavaScript函數 `openModalForMergeBooks()` 通過拼接HTML字符串來動態創建一個彈出窗口。
- **核心邏輯**: `mergeSelectedBooks()` 函數負責處理單詞的匯總、去重和新單詞本的創建。
- **主要問題**:
    1.  **缺乏交互性**: 用戶在勾選單詞本時，無法實時預覽合併後的結果（如總詞數）。
    2.  **用戶體驗較單一**: 整個操作在一個靜態表單中完成，信息呈現不夠直觀。
    3.  **代碼可維護性差**: UI完全由JS字符串拼接而成，不利於後續的迭代和維護。
    4.  **反饋機制過時**: 使用瀏覽器原生的 `alert()` 彈窗會中斷用戶流程，體驗不佳。

## 2. 重構目標

對合併單詞本的彈出窗口進行徹底重構，使其更具交互性、信息更透明，並提升代碼質量和可維護性。

## 3. 重構方案

### 第一步：重新設計彈出窗口的用戶界面 (UI)

將原來的單一表單，升級為一個兩欄佈局的交互式界面。

- **左欄 (選擇區)**:
    - 一個可滾動的列表，清晰地展示所有可供選擇的單詞本。
    - 每個單詞本旁邊都有一個複選框，並顯示該單詞本的名稱和包含的單詞數量。
- **右欄 (預覽與操作區)**:
    - **實時預覽**: 根據用戶在左欄的選擇，動態更新信息。
        - **已選列表**: 顯示用戶已勾選的所有單詞本的名稱。
        - **預計結果**: 實時計算並顯示“合併後總單詞數”(去重後)。
    - **命名與執行**:
        - 提供“新單詞本名稱”的輸入框。
        - 一個“確認合併”按鈕，只有在用戶至少選擇了兩個單詞本並輸入了名稱後，此按鈕才會被激活。

### 第二步：實現交互邏輯

- **動態計算**: 在 `app.js` 中，為左欄的複選框添加事件監聽器。每當用戶勾選或取消勾選時：
    1.  立刻重新計算選中的單詞本。
    2.  遍歷單詞，計算出去重後的唯一單詞總數。
    3.  將計算結果實時更新到右欄的“預覽區”。
    4.  根據條件判斷（是否選中超過2個，是否已命名）來更新“確認合併”按鈕的可用狀態。
- **優化合併流程**: `mergeSelectedBooks()` 函數的邏輯保持不變，但將其與新的UI更好地集成。

### 第三步：(可選) 升級通知系統

- 將最後的 `alert()` 提示，替換為一個非阻塞式的通知條（例如在頁面頂部滑出），告知用戶“合併成功”，然後自動消失，以提供更流暢的用戶體驗。

## 4. 視覺化流程圖 (Mermaid)

```mermaid
graph TD
    A[用戶點擊 "合併單詞本" 按鈕] --> B{打開重構後的合併窗口};
    B --> C[展示兩欄式佈局];
    C --> D[左欄: 單詞本選擇列表];
    C --> E[右欄: 合併預覽面板];

    subgraph 用戶交互
        F[用戶勾選/取消勾選單詞本] --觸發--> G[實時更新預覽];
        H[用戶輸入新單詞本名稱] --觸發--> G;
    end

    subgraph 預覽面板動態更新
        G --計算並更新--> E1[已選單詞本列表];
        G --計算並更新--> E2[合併後唯一單詞總數];
        G --判斷並更新--> E3[合併按鈕狀態 (激活/禁用)];
    end

    I[用戶點擊 "確認合併" 按鈕] --> J[執行合併邏輯];
    J --> K[創建新單詞本並保存];
    K --> L[更新主界面單詞本列表];
    L --> M[關閉窗口並顯示成功通知];

    D --> F;
    E3 --> I;