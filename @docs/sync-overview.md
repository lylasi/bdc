# 數據同步方案總覽（BDC）

最後更新：2025-09-29

本文件彙總三個可選同步路線，方便快速對比與決策。

— 方案 A：Local‑first＋手動備份（零後端）
- 存儲位置：瀏覽器 localStorage/IndexedDB（已存在）。
- 同步方式：使用者手動「導出/導入 JSON 檔」、或以多張 QR 分片輪播掃描。
- 登入依賴：無。
- 離線能力：滿分（完全本地）。
- 後端工作量：0。
- 優點：最簡單、免伺服器、風險低；可立刻用。
- 缺點：不自動同步；大檔需多張 QR 或下載檔。
- 適用：單人使用、小量資料、或在設計後端前的過渡期。
- 演進路徑：可直接升級到 B（匿名同步碼）或 C（帳號制）。

— 方案 B：Local‑first＋匿名同步碼（小後端）
- 存儲位置：本地仍為權威；後端僅存「壓縮／可選加密的快照」。
- 同步方式：兩端輸入同一 token → 客戶端 LWW 合併；API 僅需 HEAD/GET/PUT（ETag/If‑Match）。
- 後端選擇：JSON 檔案儲存、SQLite（WAL）、雲 KV/SQLite（Cloudflare KV/D1、Turso/libSQL）。
- 登入依賴：無（用 token 即可）。
- 離線能力：高（本地優先，恢復網絡再同步）。
- 後端工作量：低（兩三個端點）。
- 優點：快速獲得多端同步；不必設計帳號與權限。
- 缺點：token 管理與安全需留意；分享需保密；衝突在前端處理。
- 適用：個人或小團隊、先上線再優化的階段。
- 演進路徑：日後可把 token 綁定帳號，平滑轉 C。

— 方案 C：帳號制＋Supabase（完善後端）
- 存儲位置：雲端以「單行快照」起步（jsonb），或升級為「實體級表」；前端仍做 LWW。
- 同步方式：使用者登入（Email/OAuth/Passkey）；pull/push RPC；版本衝突由前端 LWW 解決。
- 後端選擇：Supabase（Auth＋PostgREST＋RPC＋RLS）。
- 登入依賴：有（安全、審計、權限完整）。
- 離線能力：高（local‑first；恢復網絡後同步）。
- 後端工作量：中（建表、RLS、兩個 RPC）。
- 優點：身份、權限、備份與可觀測性齊備；正式可擴發展。
- 缺點：比 A/B 複雜；需維護雲端專案與費率。
- 適用：面向公開使用者、需長期維護與擴展的產品。
- 演進路徑：先用快照表；數據增長後拆分到實體表、再做增量同步與 Realtime。

決策建議
- 只求最小可用：A。
- 要自動同步但先不做登入：B（推薦切入）。
- 要賬號、權限與長期演進：C（Supabase）。

