<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»˜å†™çŠ¶æ€æ åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui;
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-result {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ§ª é»˜å†™çŠ¶æ€æ åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>1. å¹³å°æ£€æµ‹æµ‹è¯•</h3>
        <button onclick="testPlatformDetection()">æ£€æµ‹å½“å‰å¹³å°</button>
        <div id="platform-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. çŠ¶æ€æŒä¹…åŒ–æµ‹è¯•</h3>
        <button onclick="testStatePersistence()">æµ‹è¯•çŠ¶æ€ä¿å­˜/åŠ è½½</button>
        <div id="state-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. æµ®åŠ¨æ§åˆ¶å™¨UIæµ‹è¯•</h3>
        <button onclick="testFloatingControls()">æ˜¾ç¤ºæµ‹è¯•çŠ¶æ€æ </button>
        <button onclick="removeFloatingControls()">ç§»é™¤çŠ¶æ€æ </button>
        <div id="ui-result" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. é¡µé¢å¯è§æ€§æµ‹è¯•</h3>
        <p>è¯·æœ€å°åŒ–æµè§ˆå™¨çª—å£æˆ–åˆ‡æ¢åˆ°å…¶ä»–æ ‡ç­¾é¡µæ¥æµ‹è¯•é¡µé¢å¯è§æ€§æ£€æµ‹ï¼š</p>
        <div id="visibility-result" class="test-result info">é¡µé¢å½“å‰å¯è§</div>
    </div>

    <script type="module">
        // å¯¼å…¥æµ‹è¯•æ‰€éœ€çš„æ¨¡å—
        import * as platform from './modules/platform.js';
        import * as state from './modules/state.js';
        
        // å°†æ¨¡å—æ·»åŠ åˆ°å…¨å±€ä½œç”¨åŸŸä»¥ä¾›æŒ‰é’®è°ƒç”¨
        window.platform = platform;
        window.state = state;
        
        // æµ‹è¯•å‡½æ•°
        window.testPlatformDetection = function() {
            const result = document.getElementById('platform-result');
            try {
                const detect = platform.detect;
                const features = platform.features;
                const viewportHeight = platform.getViewportHeight();
                
                result.className = 'test-result success';
                result.innerHTML = `
                    <strong>å¹³å°æ£€æµ‹ç»“æœï¼š</strong><br>
                    â€¢ è®¾å¤‡ç±»å‹ï¼š${detect.isMobile ? 'ç§»åŠ¨ç«¯' : 'PCç«¯'}<br>
                    â€¢ æ“ä½œç³»ç»Ÿï¼š${detect.isIOS ? 'iOS' : detect.isAndroid ? 'Android' : 'å…¶ä»–'}<br>
                    â€¢ æµè§ˆå™¨ï¼š${detect.isSafari ? 'Safari' : detect.isChrome ? 'Chrome' : detect.isFirefox ? 'Firefox' : 'å…¶ä»–'}<br>
                    â€¢ å¾®ä¿¡æµè§ˆå™¨ï¼š${detect.isWeixin ? 'æ˜¯' : 'å¦'}<br>
                    â€¢ è§†çª—é«˜åº¦ï¼š${viewportHeight}px<br>
                    â€¢ WebAudioæ”¯æŒï¼š${features.webAudio ? 'æ˜¯' : 'å¦'}<br>
                    â€¢ localStorageæ”¯æŒï¼š${features.localStorage ? 'æ˜¯' : 'å¦'}
                `;
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = 'å¹³å°æ£€æµ‹å¤±è´¥ï¼š' + error.message;
            }
        };
        
        window.testStatePersistence = function() {
            const result = document.getElementById('state-result');
            try {
                // æµ‹è¯•è®¾ç½®ä¿å­˜
                const testSettings = {
                    repeatTimes: 3,
                    wordInterval: 5,
                    readMeaning: true,
                    loopMode: true
                };
                
                state.setDictationSettings(testSettings);
                state.saveDictationSettings();
                
                // æµ‹è¯•ä¼šè¯çŠ¶æ€ä¿å­˜
                state.setDictationSessionActive(true);
                state.setCurrentDictationIndex(5);
                state.setDictationWords([
                    { word: 'test1', meaning: 'æµ‹è¯•1' },
                    { word: 'test2', meaning: 'æµ‹è¯•2' }
                ]);
                state.saveDictationSession();
                
                // æµ‹è¯•åŠ è½½
                const loadedSettings = state.loadDictationSettings();
                const loadedSession = state.loadDictationSession();
                
                result.className = 'test-result success';
                result.innerHTML = `
                    <strong>çŠ¶æ€æŒä¹…åŒ–æµ‹è¯•é€šè¿‡ï¼š</strong><br>
                    â€¢ è®¾ç½®ä¿å­˜/åŠ è½½ï¼šâœ“<br>
                    â€¢ ä¼šè¯ä¿å­˜/åŠ è½½ï¼šâœ“<br>
                    â€¢ å½“å‰ä¼šè¯çŠ¶æ€ï¼š${loadedSession ? 'æ´»è·ƒ' : 'æ— '}<br>
                    â€¢ æµ‹è¯•æ•°æ®å®Œæ•´æ€§ï¼šâœ“
                `;
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                state.clearDictationSession();
                state.setDictationSessionActive(false);
                
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = 'çŠ¶æ€æŒä¹…åŒ–æµ‹è¯•å¤±è´¥ï¼š' + error.message;
            }
        };
        
        window.testFloatingControls = function() {
            const result = document.getElementById('ui-result');
            try {
                // åˆ›å»ºæµ‹è¯•ç”¨çš„æµ®åŠ¨æ§åˆ¶å™¨
                if (document.getElementById('floating-dictation-controls')) {
                    document.getElementById('floating-dictation-controls').remove();
                }
                
                const statusBar = document.createElement('div');
                statusBar.id = 'floating-dictation-controls';
                statusBar.className = 'enhanced-floating-controls';
                
                // åˆ›å»ºä¸»æ§åˆ¶åŒºåŸŸ
                const mainControls = document.createElement('div');
                mainControls.className = 'main-controls';
                
                // æ·»åŠ æŒ‰é’®
                const prevBtn = document.createElement('button');
                prevBtn.className = 'control-btn prev-btn';
                prevBtn.innerHTML = 'â¬…';
                prevBtn.title = 'ä¸Šä¸€ä¸ª';
                
                const infoArea = document.createElement('div');
                infoArea.className = 'info-area';
                infoArea.innerHTML = '<span class="progress-text">æµ‹è¯•ä¸­ 5/10</span><span class="expand-icon">â–²</span>';
                infoArea.onclick = () => alert('å±•å¼€åŠŸèƒ½æµ‹è¯•');
                
                const pauseBtn = document.createElement('button');
                pauseBtn.className = 'control-btn pause-btn';
                pauseBtn.textContent = 'æš‚åœ';
                pauseBtn.onclick = () => {
                    pauseBtn.textContent = pauseBtn.textContent === 'æš‚åœ' ? 'ç»§ç»­' : 'æš‚åœ';
                };
                
                const nextBtn = document.createElement('button');
                nextBtn.className = 'control-btn next-btn';
                nextBtn.innerHTML = 'â¡';
                nextBtn.title = 'ä¸‹ä¸€ä¸ª';
                
                mainControls.appendChild(prevBtn);
                mainControls.appendChild(infoArea);
                mainControls.appendChild(pauseBtn);
                mainControls.appendChild(nextBtn);
                
                statusBar.appendChild(mainControls);
                document.body.appendChild(statusBar);
                
                result.className = 'test-result success';
                result.textContent = 'âœ“ æµ®åŠ¨çŠ¶æ€æ æ˜¾ç¤ºæˆåŠŸï¼è¯·æŸ¥çœ‹é¡µé¢åº•éƒ¨ã€‚';
                
            } catch (error) {
                result.className = 'test-result error';
                result.textContent = 'UIæµ‹è¯•å¤±è´¥ï¼š' + error.message;
            }
        };
        
        window.removeFloatingControls = function() {
            const controls = document.getElementById('floating-dictation-controls');
            if (controls) {
                controls.remove();
                document.getElementById('ui-result').textContent = 'âœ“ çŠ¶æ€æ å·²ç§»é™¤';
            }
        };
        
        // é¡µé¢å¯è§æ€§æµ‹è¯•
        const visibilityResult = document.getElementById('visibility-result');
        if (platform.features && typeof platform.onVisibilityChange === 'function') {
            platform.onVisibilityChange((isVisible) => {
                visibilityResult.textContent = `é¡µé¢å½“å‰${isVisible ? 'å¯è§' : 'ä¸å¯è§'} - ${new Date().toLocaleTimeString()}`;
                visibilityResult.className = `test-result ${isVisible ? 'success' : 'info'}`;
            });
        }
        
        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        console.log('ğŸ§ª é»˜å†™çŠ¶æ€æ åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“± æ£€æµ‹åˆ°çš„å¹³å°ä¿¡æ¯:', platform.detect);
    </script>
</body>
</html>