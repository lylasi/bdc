# PEN子背單詞 問答訓練模組 Brownfield Enhancement PRD

## Intro Project Analysis and Context

### 現有專案概覽

**分析來源**: IDE-based fresh analysis + 用戶提供的詳細規劃文檔

**目前專案狀態**:
PEN子背單詞是一個現代化的中文背單詞學習應用，採用ES6模組化架構，目前包含5個核心功能模組：
- 詞彙管理 (vocabulary)
- 學習模式 (learning)
- 默寫模式 (dictation)
- 測驗模式 (quiz)
- 文章分析 (article)

應用基於純前端技術棧，集成AI服務和TTS語音合成技術，採用三層架構：表示層、業務層、服務層。

### 可用文檔分析

**可用文檔**:
- ✓ 技術棧文檔 (CLAUDE.md)
- ✓ 源碼樹/架構 (模組化結構圖)
- ✓ 編碼標準 (ES6模組化規範)
- ✓ API文檔 (AI服務集成)
- ✓ 外部API文檔 (TTS配置)
- ✓ 技術債務文檔 (測試策略建議)
- ✓ 詳細實施計劃 (問答訓練模組.md)

### 增強範圍定義

**增強類型**:
- ✓ 新功能添加 (問答訓練系統)
- ✓ 與新系統集成 (AI校對、PDF導出)

**增強描述**:
創建一個獨立的問答訓練模組，作為PEN子背單詞應用的第6個功能模組，支援問答集管理、AI智能校對、PDF導出等功能，為用戶提供全新的問答式學習體驗。

**影響評估**:
- ✓ 中等影響 (一些現有代碼變更)
  - 需要更新 main.js 導航邏輯
  - 需要更新 index.html 主界面
  - 需要擴展 modules/api.js 和 modules/state.js

### 目標和背景脈絡

**目標**:
- 為用戶提供問答式學習模式，豐富學習方式
- 實現AI智能校對，提供個性化學習反饋
- 支援PDF導出，滿足線下學習需求
- 建立問答集創建和管理系統，支持用戶自定義內容
- 保持與現有架構的一致性和無縫集成

**背景脈絡**:
隨著用戶對多樣化學習方式的需求增長，單純的詞彙背誦已無法滿足深度學習需求。問答訓練模組將填補這一空白，提供更互動和智能的學習體驗。此增強與現有專案的AI驅動學習理念完全吻合，並將進一步豐富應用的學習生態系統。

**變更日誌**:
| 變更 | 日期 | 版本 | 描述 | 作者 |
|------|------|------|------|------|
| 初始PRD創建 | 2025-01-16 | v1.0 | 基於詳細規劃文檔創建問答訓練模組PRD | Product Manager |

## Requirements

### Functional

**FR1**: 問答訓練模組須提供完整的問答集管理功能，包括創建、導入、導出、刪除問答集，並支援localStorage本地存儲和JSON文件格式

**FR2**: 系統須支援Q1:A1:格式的批量問答對輸入，提供實時解析預覽，並驗證格式正確性

**FR3**: 問答訓練功能須支援順序和隨機兩種問題呈現模式，允許用戶選擇逐題提交或批量提交答案

**FR4**: AI校對功能須智能判斷用戶答案的正確性，生成包含正確性、反饋內容和改進建議的校對報告

**FR5**: 系統須實現並發控制機制，最多同時處理3個AI校對請求，並提供進度指示

**FR6**: 校對結果須緩存至localStorage，支援多次提交和獨立報告生成，避免重複的AI請求

**FR7**: PDF導出功能須支援完整問答導出和純問題導出兩種模式，後者用下劃線替代答案以供手寫練習

**FR8**: 導出的PDF須支援中文字體，並提供可自定義的字體大小、行間距和頁邊距設置

**FR9**: 問答訓練介面須提供清晰的進度指示，包括當前題號、總題數和完成百分比

**FR10**: 模組須與現有導航系統無縫集成，作為第6個功能模組出現在主導航中

### Non Functional

**NFR1**: 問答模組須維持現有應用的性能特徵，AI校對請求響應時間不超過5秒，界面響應時間不超過200ms

**NFR2**: localStorage存儲須包含數據完整性驗證，防止數據損壞，並提供優雅的錯誤處理機制

**NFR3**: 模組須完全兼容現有的移動端優化策略，支援觸摸操作最小44px區域和響應式佈局

**NFR4**: AI校對功能須實現優雅降級，當AI服務不可用時仍能進行基本的問答訓練

**NFR5**: 系統須保持與現有模組一致的載入時間，新增模組不應影響其他功能的性能

**NFR6**: PDF生成須在客戶端完成，不依賴外部服務，確保用戶數據隱私和離線可用性

**NFR7**: 記憶體使用量不應超過現有應用的20%，特別是在處理大型問答集時

**NFR8**: 所有用戶輸入須進行適當的清理和驗證，防止XSS攻擊和數據注入

### Compatibility Requirements

**CR1**: API兼容性 - 新增的AI校對API須與現有的modules/api.js完全兼容，共享相同的錯誤處理和配置機制

**CR2**: 數據庫架構兼容性 - localStorage數據結構須與現有狀態管理系統兼容，不影響現有數據的完整性

**CR3**: UI/UX一致性 - 問答模組界面須遵循現有的設計語言和交互模式，使用相同的CSS類和組件庫

**CR4**: 集成兼容性 - 模組須與現有的音頻服務、DOM管理和狀態管理系統完全兼容，不產生衝突

## User Interface Enhancement Goals

### Integration with Existing UI

問答訓練模組的UI設計將完全融入現有的設計系統和組件庫。新的UI元素將復用existing的CSS類別和設計模式：

- **導航整合**: 在現有的5個功能圖標後新增問答訓練圖標，保持一致的圖標風格和hover效果
- **佈局模式**: 採用與其他模組相同的容器結構和響應式網格系統
- **組件復用**: 使用現有的modules/ui.js中的模態框、步進器、按鈕等通用組件
- **色彩主題**: 遵循現有的藍色主題色(#007bff)和配色方案
- **字體系統**: 保持與現有應用一致的字體家族和大小層級

### Modified/New Screens and Views

**新增的主要界面區域**:

1. **問答訓練區域** (qa-training-area)
   - 問題顯示卡片
   - 答案輸入框
   - 進度條和題號指示器
   - 上一題/下一題導航按鈕
   - 提交答案按鈕組

2. **問答集管理區域** (qa-management-area)
   - 問答集列表視圖
   - 導入/導出按鈕組
   - 刪除和編輯操作
   - 問答集統計資訊

3. **問答集創建區域** (qa-creator-area)
   - Q1:A1:格式批量輸入文本框
   - 實時解析預覽面板
   - 格式驗證提示
   - 保存新問答集表單

4. **校對報告顯示區域** (qa-report-area)
   - 校對結果摘要
   - 詳細反饋列表
   - 準確率統計圖表
   - 導出PDF按鈕

**修改的現有界面**:
- **主導航列**: 新增第6個問答訓練圖標
- **主容器**: 新增問答模組的顯示/隱藏邏輯

### UI Consistency Requirements

**視覺一致性要求**:

1. **間距標準**: 使用現有的8px網格系統進行元素間距
2. **圓角規範**: 按鈕和卡片使用統一的border-radius: 8px
3. **陰影效果**: 採用現有的box-shadow樣式層級
4. **動畫過渡**: 使用一致的transition: all 0.3s ease動畫效果

**交互一致性要求**:

1. **觸摸目標**: 所有可點擊元素最小44px觸摸區域(移動端)
2. **狀態反饋**: 按鈕hover、active、disabled狀態與現有模組保持一致
3. **載入狀態**: 使用相同的loading spinner和骨架屏模式
4. **錯誤提示**: 採用現有的toast通知和錯誤訊息樣式

**響應式一致性要求**:

1. **斷點標準**: 遵循現有的768px移動端斷點
2. **佈局適配**: 在小屏幕設備上採用相同的垂直堆疊模式
3. **字體縮放**: 使用現有的響應式字體大小規則
4. **導航適配**: 在移動端使用底部固定導航模式

## Technical Constraints and Integration Requirements

### Existing Technology Stack

**語言**: JavaScript (ES6+), HTML5, CSS3
**框架**: 純前端架構，無外部JavaScript框架依賴
**資料庫**: localStorage (客戶端存儲)
**基礎設施**: 靜態文件服務器 (Python http.server / Node.js http-server)
**外部依賴**:
- jsPDF 2.5.1 (PDF生成) - 新增
- html2canvas 1.4.1 (截圖支援) - 新增
- AI API服務 (OpenAI兼容接口)
- TTS語音合成服務

### Integration Approach

**資料庫整合策略**:
- 擴展現有localStorage架構，新增qa-sets命名空間
- 利用modules/storage.js統一存儲接口，添加QA相關方法
- 實現數據版本控制和遷移策略，確保向後兼容性
- 建立qa-sets/manifest.json清單管理機制

**API整合策略**:
- 擴展modules/api.js，新增checkQAAnswer和batchCheckAnswers方法
- 實現並發控制隊列類ConcurrentQueue，限制同時3個AI請求
- 復用現有的錯誤處理機制和API配置管理
- 建立QA校對專用的prompt模板和響應解析邏輯

**前端整合策略**:
- 在features/qa/目錄下建立獨立模組，包含qa.js主入口
- 更新main.js的模組初始化和導航邏輯
- 擴展modules/dom.js和modules/state.js以支援QA功能
- 利用現有的modules/ui.js組件庫，確保UI一致性

**測試整合策略**:
- 沿用現有的瀏覽器控制台手動測試方法
- 建立QA模組專用的功能測試檢查清單
- 實現localStorage數據完整性驗證
- 添加AI API連接和並發控制的測試覆蓋

### Code Organization and Standards

**文件結構方法**:
```
features/qa/
├── qa.js           # 主模組入口，導出init/show/hide方法
├── qa-trainer.js   # 訓練邏輯和會話管理
├── qa-checker.js   # AI校對和並發控制
├── qa-creator.js   # 問答集創建和格式解析
├── qa-pdf.js       # PDF導出功能
└── qa-storage.js   # QA專用存儲方法
```

**命名慣例**:
- 文件名: 小寫+連字符 (qa-trainer.js)
- 函數名: 駝峰命名 (generateQAReport)
- 常量: 大寫+下劃線 (MAX_CONCURRENT_REQUESTS)
- CSS類: 小寫+連字符 (qa-training-area)

**編碼標準**:
- 嚴格遵循ES6模組化語法，每個模組導出特定功能
- 統一錯誤處理，使用try-catch包裝AI調用
- 實現優雅降級，AI服務不可用時提供基本功能
- 所有DOM操作通過modules/dom.js統一管理

**文檔標準**:
- 為qa目錄建立CLAUDE.md模組文檔
- 在主CLAUDE.md中更新模組索引表
- 為新增的API方法提供JSDoc註釋
- 建立QA數據格式和API介面規範文檔

### Deployment and Operations

**建置過程整合**:
- 無需修改現有建置流程，保持靜態文件部署模式
- 新增jsPDF和html2canvas CDN依賴到index.html
- 確保qa-sets目錄包含在部署包中
- 驗證所有新增文件的CORS兼容性

**部署策略**:
- 採用現有的漸進式部署方法
- 先部署核心QA功能，再逐步啟用AI校對和PDF導出
- 實現功能開關，允許運行時啟用/禁用QA模組
- 建立回滾機制，確保新功能不影響現有模組

**監控和日誌**:
- 擴展現有的控制台日誌機制，添加QA模組特定事件
- 監控AI API調用頻率和響應時間
- 追蹤localStorage使用量和PDF生成性能
- 建立用戶操作行為日誌以優化體驗

**配置管理**:
- 復用現有的ai-config.js配置檔案
- 新增QA模組專用配置選項 (並發數、緩存過期時間)
- 實現配置熱重載，無需重啟應用
- 建立配置驗證機制，確保設定正確性

### Risk Assessment and Mitigation

**技術風險**:
- **風險**: jsPDF中文字體支援限制 → **緩解**: 使用Unicode字體和fallback機制
- **風險**: localStorage容量限制 → **緩解**: 實現數據清理和壓縮策略
- **風險**: AI API配額超限 → **緩解**: 本地緩存和並發控制

**整合風險**:
- **風險**: 新模組影響現有性能 → **緩解**: 懶加載和資源優化
- **風險**: DOM衝突和樣式覆蓋 → **緩解**: CSS命名空間和模組化樣式
- **風險**: 狀態管理複雜化 → **緩解**: 明確的狀態邊界和更新機制

**部署風險**:
- **風險**: CDN依賴不可用 → **緩解**: 本地備份和優雅降級
- **風險**: 瀏覽器兼容性問題 → **緩解**: 漸進增強和polyfill
- **風險**: 用戶數據遷移失敗 → **緩解**: 數據備份和恢復機制

**緩解策略**:
- 實施全面的錯誤邊界處理
- 建立用戶數據自動備份機制
- 提供完整的功能回退方案
- 建立監控和告警系統

## Epic and Story Structure

### Epic Approach

**Epic結構決策**: 單一綜合Epic

基於對現有專案的分析，問答訓練模組雖然功能豐富，但本質上是一個邏輯緊密相關的功能增強。所有子功能都圍繞同一個核心目標：為用戶提供完整的問答式學習體驗，因此採用單一Epic結構。

## Epic 1: 問答訓練模組完整實現

**Epic目標**: 創建一個功能完整的問答訓練模組，作為PEN子背單詞應用的第6個核心功能，提供問答集管理、智能訓練、AI校對和PDF導出等完整學習體驗，同時確保與現有系統的無縫集成和功能完整性。

**整合需求**:
- 完全遵循現有ES6模組化架構模式
- 復用現有AI服務和TTS技術棧
- 保持UI/UX設計語言的一致性
- 確保現有功能模組的完整性和性能不受影響

### Story 1.1 建立問答模組基礎架構

作為一個開發者，
我想要建立問答模組的基礎架構和文件結構，
以便為後續功能開發提供穩固的技術基礎。

**Acceptance Criteria**:
1. 創建 `features/qa/` 目錄結構，包含所有必要的模組檔案
2. 實現 `qa.js` 主入口模組，導出標準的 `init()`, `showQAModule()`, `hideQAModule()` 方法
3. 更新 `main.js` 添加問答模組的初始化和導航邏輯
4. 擴展 `modules/dom.js` 添加問答模組相關的DOM選擇器
5. 在 `index.html` 中添加問答模組的基本HTML結構

**Integration Verification**:
- IV1: 驗證現有5個功能模組的導航和顯示/隱藏邏輯仍正常運作
- IV2: 確認模組載入不影響應用啟動時間和記憶體使用
- IV3: 測試新增的DOM元素不與現有樣式產生衝突

### Story 1.2 實現問答集數據管理系統

作為一個用戶，
我想要能夠創建、儲存和管理我的問答集，
以便組織和重用我的學習內容。

**Acceptance Criteria**:
1. 實現 `qa-storage.js` 模組，提供問答集的CRUD操作
2. 建立localStorage數據結構，支援問答集清單和內容存儲
3. 創建 `qa-sets/manifest.json` 清單管理機制
4. 實現問答集的導入/導出JSON功能
5. 提供數據完整性驗證和錯誤恢復機制

**Integration Verification**:
- IV1: 驗證localStorage操作不影響現有詞彙和設定數據
- IV2: 確認數據存儲格式與現有storage.js模組兼容
- IV3: 測試大量數據存儲不超過瀏覽器限制

### Story 1.3 創建問答集創建和編輯界面

作為一個用戶，
我想要通過Q1:A1:格式批量輸入問答對，
以便快速創建新的問答集。

**Acceptance Criteria**:
1. 實現 `qa-creator.js` 模組，支援Q1:A1:格式解析
2. 提供批量輸入文本框和實時解析預覽
3. 實現格式驗證和錯誤提示機制
4. 提供問答集基本資訊編輯（名稱、描述、分類）
5. 實現解析結果的確認和保存功能

**Integration Verification**:
- IV1: 驗證新增UI組件使用現有的modules/ui.js組件庫
- IV2: 確認輸入驗證機制與現有表單驗證一致
- IV3: 測試大量文本輸入的性能和響應性

### Story 1.4 開發問答訓練核心功能

作為一個學習者，
我想要進行問答訓練並提交我的答案，
以便測試和提升我的知識掌握程度。

**Acceptance Criteria**:
1. 實現 `qa-trainer.js` 訓練會話管理和狀態控制
2. 提供順序和隨機兩種問題呈現模式
3. 支援逐題提交和批量提交兩種答案模式
4. 實現清晰的進度指示和導航控制
5. 提供訓練會話的暫停和恢復功能

**Integration Verification**:
- IV1: 驗證訓練界面使用現有的響應式佈局系統
- IV2: 確認狀態管理與modules/state.js協調一致
- IV3: 測試訓練過程中其他模組的訪問不受影響

### Story 1.5 集成AI智能校對功能

作為一個學習者，
我想要獲得AI對我答案的智能評判和建議，
以便了解我的答案品質並改進學習效果。

**Acceptance Criteria**:
1. 實現 `qa-checker.js` AI校對邏輯和並發控制
2. 擴展 `modules/api.js` 添加問答校對專用API方法
3. 實現3個並發請求的隊列控制機制
4. 提供校對結果的緩存和重用機制
5. 生成包含正確性、反饋和建議的詳細報告

**Integration Verification**:
- IV1: 驗證AI API調用使用現有的錯誤處理和配置系統
- IV2: 確認並發控制不影響其他模組的API調用
- IV3: 測試AI服務不可用時的優雅降級機制

### Story 1.6 實現PDF導出功能

作為一個用戶，
我想要將問答集導出為PDF格式，
以便進行離線學習和手寫練習。

**Acceptance Criteria**:
1. 實現 `qa-pdf.js` 模組，集成jsPDF庫
2. 支援完整問答和純問題兩種導出模式
3. 提供可自定義的字體、間距和格式設定
4. 實現中文字體支援和版面最佳化
5. 提供PDF預覽和下載功能

**Integration Verification**:
- IV1: 驗證PDF生成庫載入不影響應用啟動性能
- IV2: 確認PDF導出功能在不同瀏覽器中的兼容性
- IV3: 測試大量內容的PDF生成性能和記憶體使用

### Story 1.7 優化移動端用戶體驗

作為一個移動端用戶，
我想要在手機上流暢地使用問答訓練功能，
以便隨時隨地進行學習。

**Acceptance Criteria**:
1. 實現響應式佈局，適配小屏幕設備
2. 優化觸摸目標大小，確保最小44px點擊區域
3. 適配底部導航模式，與現有移動端設計一致
4. 實現手勢支援（如滑動切換題目）
5. 優化虛擬鍵盤顯示時的界面適配

**Integration Verification**:
- IV1: 驗證移動端適配不影響桌面端的使用體驗
- IV2: 確認觸摸優化與現有模組的移動端體驗一致
- IV3: 測試不同設備和瀏覽器的兼容性

### Story 1.8 完善錯誤處理和用戶反饋

作為一個用戶，
我想要在遇到問題時獲得清晰的錯誤提示和解決建議，
以便順利完成我的學習任務。

**Acceptance Criteria**:
1. 實現全面的錯誤邊界處理和用戶友好提示
2. 提供網絡失敗時的重試機制和離線模式
3. 實現數據損壞時的自動恢復和備份機制
4. 提供詳細的操作指引和幫助文檔
5. 實現用戶操作的確認和撤銷機制

**Integration Verification**:
- IV1: 驗證錯誤處理機制與現有模組的一致性
- IV2: 確認錯誤狀態不會影響其他功能模組的正常運作
- IV3: 測試極端情況下的系統穩定性和數據完整性

---

*此PRD文檔創建於 2025-01-16，基於詳細的問答訓練模組實施計劃制定。*